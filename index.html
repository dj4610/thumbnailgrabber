<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Thumbnail Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: #121212; color: #e0e0e0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* Container Utama */
        .controls { background: #1e1e1e; padding: 25px; border-radius: 12px; width: 100%; max-width: 900px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.6); border: 1px solid #333; }
        
        /* Baris & Input */
        .row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; }
        .full-width { width: 100%; }
        
        input[type="text"], input[type="password"] { 
            padding: 12px; border-radius: 6px; border: 1px solid #444; 
            background: #2c2c2c; color: white; flex: 1; font-size: 14px;
        }
        
        /* Tombol */
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; color: white; font-size: 14px; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        button:active { transform: translateY(0); }

        .btn-blue { background: #4285F4; } /* Warna Google Blue */
        .btn-gemini { 
            background: linear-gradient(90deg, #4285F4, #9B72CB, #D96570); /* Warna Gradien Gemini */
            box-shadow: 0 0 15px rgba(66, 133, 244, 0.4);
        }
        .btn-green { background: #0F9D58; }
        .btn-red { background: #DB4437; }
        
        /* Canvas */
        .canvas-container-style { border: 2px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        
        /* Status */
        #statusInfo { font-size: 0.9em; color: #9B72CB; margin-top: 5px; font-style: italic; }
        .api-note { font-size: 0.8em; color: #aaa; margin-bottom: 10px; background: #252525; padding: 10px; border-radius: 5px; border-left: 4px solid #4285F4;}
    </style>
</head>
<body>

    <h1 style="background: linear-gradient(90deg, #4285F4, #D96570); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        ‚ú¶ Gemini Thumbnail Magic (Fixed)
    </h1>

    <div class="controls">
        <div class="api-note">
            üîë <strong>Wajib:</strong> Masukkan Google Gemini API Key. <br>
            Dapatkan Gratis di: <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:#4285F4;">Google AI Studio</a>.
        </div>
        <div class="row">
            <input type="password" id="geminiKey" placeholder="Tempel API Key Gemini di sini (AIza...)">
        </div>

        <hr style="border-color: #333; margin: 20px 0;">

        <div class="row">
            <input type="text" id="ytUrl" placeholder="Link YouTube atau Topik Video...">
            <button class="btn-blue" onclick="loadYoutubeImage()">üì∏ 1. Ambil Gambar</button>
        </div>

        <div class="row">
            <button class="btn-gemini full-width" onclick="askGeminiTitle()">‚ú® 2. Minta Gemini Buatkan Judul Clickbait</button>
        </div>
        <div id="statusInfo"></div>

        <hr style="border-color: #333; margin: 20px 0;">

        <div class="row">
            <button class="btn-blue" onclick="addText()">+ Teks</button>
            <input type="color" id="colorPicker" value="#ffff00" onchange="changeColor()" style="flex: 0 0 50px; height: 40px; cursor:pointer;">
            <button class="btn-red" onclick="deleteObject()">Hapus Objek</button>
            <div style="flex:1;"></div>
            <button class="btn-green" onclick="downloadImage()">üíæ Download JPG</button>
        </div>
    </div>

    <div class="canvas-container-style">
        <canvas id="c" width="1280" height="720"></canvas>
    </div>

<script>
    // --- SETUP CANVAS ---
    const canvas = new fabric.Canvas('c');
    canvas.setBackgroundColor('#000', canvas.renderAll.bind(canvas));

    // --- FUNGSI GEMINI AI (YANG SUDAH DIPERBAIKI) ---
    async function askGeminiTitle() {
        const apiKey = document.getElementById('geminiKey').value;
        const topic = document.getElementById('ytUrl').value || "Video Seru";
        const statusDiv = document.getElementById('statusInfo');

        if (!apiKey) {
            alert("Harap masukkan Gemini API Key terlebih dahulu!");
            return;
        }

        statusDiv.innerText = "ü§ñ Gemini sedang berpikir...";

        // ---> INI DIA PERBAIKANNYA: Menggunakan 'gemini-pro' <---
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;

        // Prompt Engineering
        const promptText = `Buatkan 1 judul YouTube thumbnail yang PENDEK (maksimal 6 kata), SENSASIONAL, dan MEMBUAT PENASARAN (Clickbait) untuk topik: "${topic}". Tulis judulnya saja tanpa tanda kutip. Gunakan HURUF KAPITAL.`;

        const requestBody = {
            contents: [{
                parts: [{ text: promptText }]
            }]
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });

            const data = await response.json();

            if (data.error) {
                // Jika masih error, tampilkan pesan detail
                throw new Error(data.error.message);
            }

            // Ambil teks hasil generate
            if (data.candidates && data.candidates.length > 0) {
                const resultText = data.candidates[0].content.parts[0].text.trim();
                statusDiv.innerText = "‚úÖ Berhasil!";
                addText(resultText); // Masukkan ke layar
            } else {
                statusDiv.innerText = "‚ö†Ô∏è AI tidak menjawab. Coba lagi.";
            }

        } catch (error) {
            console.error(error);
            statusDiv.innerText = "‚ùå Gagal: " + error.message;
            // Pesan error yang lebih jelas
            alert("Gagal menghubungi Gemini. Pastikan API Key Anda benar dan koneksi internet lancar.\n\nDetail Error: " + error.message);
        }
    }

    // --- FUNGSI EDITOR STANDAR ---
    function loadYoutubeImage() {
        const url = document.getElementById('ytUrl').value;
        let videoId = "";
        
        // Logika ambil ID Youtube
        if (url.includes('v=')) videoId = url.split('v=')[1].split('&')[0];
        else if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1].split('?')[0];

        if (videoId) {
            const imgUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
            fabric.Image.fromURL(imgUrl, function(img) {
                img.scaleToWidth(1280);
                img.scaleToHeight(720);
                canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
                document.getElementById('statusInfo').innerText = "Gambar termuat.";
            }, { crossOrigin: 'anonymous' });
        } else {
            alert("Link tidak valid! Masukkan link YouTube yang benar.");
        }
    }

    function addText(customText = "JUDUL BARU") {
        customText = customText.replace(/^"|"$/g, '');
        
        const text = new fabric.IText(customText, {
            left: 50, top: 100, 
            fontFamily: 'Impact', // Font umum thumbnail
            fill: document.getElementById('colorPicker').value,
            fontSize: 100, 
            stroke: '#000', strokeWidth: 3,
            shadow: new fabric.Shadow({ color: 'black', blur: 30 })
        });
        canvas.add(text);
        canvas.setActiveObject(text);
    }

    function deleteObject() {
        const activeObj = canvas.getActiveObject();
        if (activeObj) canvas.remove(activeObj);
    }

    function changeColor() {
        const color = document.getElementById('colorPicker').value;
        const activeObj = canvas.getActiveObject();
        if (activeObj) { 
            activeObj.set('fill', color); 
            canvas.requestRenderAll(); 
        }
    }

    function downloadImage() {
        const dataURL = canvas.toDataURL({ format: 'jpeg', quality: 0.9 });
        const link = document.createElement('a');
        link.download = 'gemini-thumbnail.jpg';
        link.href = dataURL;
        link.click();
    }
</script>

</body>
</html>
